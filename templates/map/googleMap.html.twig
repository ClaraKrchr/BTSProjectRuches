{% extends 'base.html.twig' %}
  {% block body %}
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title> Carte des ruchers </title>
    
  	<link rel="stylesheet" href="{{ asset('css/googleMap.css') }}">
    <div id="map"></div>
    {% endblock %}
    {% block javascripts %}
    <script>
      function initMap() {
        var thalesLatLng = {lat: 43.564693450927734, lng: 1.3840949535369873};
        var montluconLatLng = {lat: 46.33901824773936, lng: 2.601431095609703};
        var bourgesLatLng = {lat: 47.081939697265625, lng: 2.395517110824585};
        
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: montluconLatLng
        });
        
        var markers = [];
        var i = 0;
        
      	{% for rucher in ruchers %}
	        var rucherLatLng = {lat: {{ rucher.latitude }}, lng: {{ rucher.longitude }}};
	
	        var marker = new google.maps.Marker({
	          position: rucherLatLng,
	          map: map,
	          title: '{{ rucher.nom }}'
	        });
	        
	        markers[i] = marker;
	        
	        markers[i++].addListener('click', function() {
	          map.setZoom(8);
	          map.setCenter(this.getPosition());
	        });
	        
	        var infoWindow = new google.maps.InfoWindow({content: '', position: montluconLatLng});
	        
	        map.addListener('click', function(mapsMouseEvent) {
	        infoWindow.close();
	        	infoWindow = new google.maps.InfoWindow({position: mapsMouseEvent.latLng});
	        	infoWindow.setContent(mapsMouseEvent.latLng.toString());
	        	infoWindow.open(map);
	        	map.setCenter(mapsMouseEvent.latLng);
	        	if(map.zoom < 7) map.setZoom(7);
	        });

        {% endfor %}
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5XVy1MyiVkAVOX_DbdOEuTWobpiQzgM8&callback=initMap">
    </script>
    {% endblock %}